<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.9.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="关注网络安全">
  <meta name="keyword" content="web安全 代码审计">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      影风博客
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    <script src="/js/qrious.js"></script>
  
  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


</head>
<div class="wechat-share">
  <img src="/css/images/logo.png">
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>影风博客</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">主页</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">所有文章</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">标签</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">关于</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">主页</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">所有文章</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">标签</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">关于</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2></h2>
  <p class="post-date">2019-07-27</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><p>最近研究<code>PHP</code>漏洞的挖掘，总结和整理了一下思路，求各路神人补充、批评、指导~</p>
<p>本文所有示例均来自我在乌云上已由厂商允许公开的漏洞</p>
<p>由于是实例的分析，基础知识请百度，就不全都粘贴到前面了</p>
<h2 id="0x01-搜索所有的用户可控变量（GET-POST-COOKIE-referer）"><a href="#0x01-搜索所有的用户可控变量（GET-POST-COOKIE-referer）" class="headerlink" title="0x01:  搜索所有的用户可控变量（GET/POST/COOKIE/referer）"></a>0x01:  搜索所有的用户可控变量（GET/POST/COOKIE/referer）</h2><p>原因：所有用户输入都是有害的，代码审计注重函数和变量，先看看在什么地方会有输入</p>
<p>可能出现的场景：</p>
<h3 id="a-id-GET-‘id’"><a href="#a-id-GET-‘id’" class="headerlink" title="a) id=$_GET[‘id’];"></a>a) id=$_GET[‘id’];</h3><p>可能存在的问题：</p>
<p>无过滤的<code>SQL</code>注入：</p>
<p><a href="http://wooyun.anquan.us/bug_detail.php?wybug_id=wooyun-2013-040338" target="_blank">WooYun: chshcms 程氏CMS V3.0 注射（已在官方演示站测试）</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$id=trim($_GET[<span class="string">"id"</span>]);    </span><br><span class="line"><span class="comment">//下面直接就进查询语句了</span></span><br><span class="line"><span class="keyword">if</span>($db-&gt;query(<span class="string">"update "</span>.Getdbname(<span class="string">'dance'</span>).<span class="string">" set CS_TID="</span>.$tid.<span class="string">" where cs_user='"</span>.$cscms_name.<span class="string">"' and</span></span><br></pre></td></tr></table></figure>

<p>当然，这是<code>GET</code>之后没做过滤的情景</p>
<h3 id="b-id-intval-GET-‘id’"><a href="#b-id-intval-GET-‘id’" class="headerlink" title="b) id=intval($_GET[‘id’]);"></a>b) id=intval($_GET[‘id’]);</h3><p>可能存在的问题：<code>intval</code>对字符型无用，字符型变量是怎么处理的呢？</p>
<p>如果字符型的<code>addslashes</code>，注意数字型盲注（见<code>c2</code>分析）</p>
<h3 id="c-tid-XX-Request-“tid”"><a href="#c-tid-XX-Request-“tid”" class="headerlink" title="c) $tid=XX_Request(“tid”);"></a>c) $tid=XX_Request(“tid”);</h3><p>使用自己定义的安全过滤函数处理变量，很常见，很多框架都提供了解决方案，不过自己包装一个也是很常见的</p>
<p>可能存在的问题：</p>
<h3 id="c1-有没有忘记使用这个处理函数？"><a href="#c1-有没有忘记使用这个处理函数？" class="headerlink" title="c1) 有没有忘记使用这个处理函数？"></a>c1) 有没有忘记使用这个处理函数？</h3><p><a href="http://wooyun.anquan.us/bug_detail.php?wybug_id=wooyun-2013-040338" target="_blank">WooYun: chshcms 程氏CMS V3.0 注射（已在官方演示站测试）</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$tid=CS_Request(<span class="string">"tid"</span>); <span class="comment">//使用安全的CS_request addslash  </span></span><br><span class="line">$id=trim($_GET[<span class="string">"id"</span>]);  <span class="comment">//呵呵呵，曲项向天歌，CS_Request哭了</span></span><br></pre></td></tr></table></figure>

<p>其实还是上面那个例子，自己忘了用这函数过滤了</p>
<h3 id="c2-函数本身是否安全？"><a href="#c2-函数本身是否安全？" class="headerlink" title="c2) 函数本身是否安全？"></a>c2) 函数本身是否安全？</h3><p><a href="http://wooyun.anquan.us/bug_detail.php?wybug_id=wooyun-2013-044824" target="_blank">WooYun: (新)程氏舞曲CMS 三步GETSHELL（实例演示+源码详析）</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$t_Val = $magic?trim($_GET[$pi_strName]):addslashes(trim($_GET[$pi_strName]));</span><br></pre></td></tr></table></figure>

<p>使用了<code>addslashes</code>，这就意味着逃脱单引号难度加大，需要寻找没有单引号保护的语句注入</p>
<p><code>addslashes</code>只处理单引号和斜杠，因此无法过滤形如<code>134 and 1=1</code>这样的注射语句，请自行百度无单引号盲注</p>
<p>在下面的语句中，<code>$cscms_name</code>就是有单引号保护的，而<code>$id</code>是没有单引号保护的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$db-&gt;query(<span class="string">"update "</span>.Getdbname(<span class="string">'xiaoxi'</span>).<span class="string">" set CS_DID=1 where CS_ID="</span>.$id.<span class="string">" and cs_usera='"</span>.$cscms_name.<span class="string">"'"</span>);</span><br></pre></td></tr></table></figure>

<p>所以<code>id</code>引发了盲注</p>
<h3 id="c3-过滤函数能否满足业务逻辑的特殊需求？"><a href="#c3-过滤函数能否满足业务逻辑的特殊需求？" class="headerlink" title="c3) 过滤函数能否满足业务逻辑的特殊需求？"></a>c3) 过滤函数能否满足业务逻辑的特殊需求？</h3><p>负数订单啦，自己修改自己的投票数啦，各种业务逻辑上的问题都有可能发生</p>
<p>非常可惜，这个我还没撞见过，如果以后撞见再更新到文章里</p>
<h3 id="d-不要忘记我们能控制referer等变量"><a href="#d-不要忘记我们能控制referer等变量" class="headerlink" title="d) 不要忘记我们能控制referer等变量"></a>d) 不要忘记我们能控制referer等变量</h3><p>可能存在的问题：</p>
<p>虽然发现<code>GET/POST</code>都过滤处理了，但是<code>referer</code>和<code>cookie</code>容易被忽视</p>
<p><code>$_SERVER[&quot;HTTP_REFERER&quot;]</code>例子：</p>
<p><a href="http://wooyun.anquan.us/bug_detail.php?wybug_id=wooyun-2013-038804" target="_blank">WooYun: MacCMS 6.x referer处理不当引发注射</a></p>
<p>很遗憾，这个截至今日还未公开，等公开了大家再去看吧</p>
<p><code>$_COOKIE[&#39;xxx&#39;]</code>例子：</p>
<p><a href="http://wooyun.anquan.us/bug_detail.php?wybug_id=wooyun-2013-041200" target="_blank">WooYun: TCCMS全版本COOKIE注入（已演示证明）</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"select password from "</span>.$_Obj-&gt;table.<span class="string">" where id="</span>.$_COOKIE[<span class="string">'userId'</span>];</span><br></pre></td></tr></table></figure>

<p>情况和<code>GET</code>时是一样的，不过注入时操作起来稍微麻烦些，<code>SQLMAP</code>教程我就不粘贴到这里了，不会<code>COOKIE</code>注入的请百度</p>
<h3 id="e-还有其他的输入变量，请各路高手带着实例补充！"><a href="#e-还有其他的输入变量，请各路高手带着实例补充！" class="headerlink" title="e) 还有其他的输入变量，请各路高手带着实例补充！"></a>e) 还有其他的输入变量，请各路高手带着实例补充！</h3><p>目前，我们了解了程序总体上是如何处理用户输入的</p>
<h2 id="0x02：单独搜索-COOKIE，分析身份认证时的逻辑"><a href="#0x02：单独搜索-COOKIE，分析身份认证时的逻辑" class="headerlink" title="0x02：单独搜索$_COOKIE，分析身份认证时的逻辑"></a>0x02：单独搜索$_COOKIE，分析身份认证时的逻辑</h2><p>原因：身份验证属于业务逻辑中“高危”的部分，大部分的高危漏洞都出在这里</p>
<p>可能出现的场景：</p>
<h3 id="a-没有cookie处理，直接全是session"><a href="#a-没有cookie处理，直接全是session" class="headerlink" title="a) 没有cookie处理，直接全是session"></a>a) 没有<code>cookie</code>处理，直接全是session</h3><p>那就等之后通读代码时直接去读认证算法好啦</p>
<h3 id="b-认证算法中强度太弱（用可控的COOKIE算来算去），降低了伪造身份的难度"><a href="#b-认证算法中强度太弱（用可控的COOKIE算来算去），降低了伪造身份的难度" class="headerlink" title="b) 认证算法中强度太弱（用可控的COOKIE算来算去），降低了伪造身份的难度"></a>b) 认证算法中强度太弱（用可控的COOKIE算来算去），降低了伪造身份的难度</h3><p><a href="http://wooyun.anquan.us/bug_detail.php?wybug_id=wooyun-2013-044824" target="_blank">WooYun: (新)程氏舞曲CMS 三步GETSHELL（实例演示+源码详析）</a></p>
<p>第二步伪造身份时</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elseif</span>($_COOKIE[<span class="string">'CS_Login'</span>]!=md5($_COOKIE[<span class="string">'CS_AdminID'</span>].$_COOKIE[<span class="string">'CS_AdminUserName'</span>].$_COOKIE[<span class="string">'CS_AdminPassWord'</span>].$_COOKIE[<span class="string">'CS_Quanx'</span>]))&#123;</span><br></pre></td></tr></table></figure>

<p>有什么意义呢？<code>COOKIE</code>我们能控制，当然之后程序有别的验证，这里只是举例，就这一句而言没有意义</p>
<p>实际上漏洞里这个<code>CMS</code>这个算法，后面只是在认证时没有用到安装时<code>admin</code>写死在<code>config</code>里的验证码而已，不过难度已经降下来了</p>
<h3 id="c-直接能绕过"><a href="#c-直接能绕过" class="headerlink" title="c) 直接能绕过"></a>c) 直接能绕过</h3><p>如果情况<code>b</code>没有其他验证了，那就绕过了</p>
<p>目前我们只是验证了登陆时的逻辑，之后还需分析权限的缜密程度</p>
<h2 id="0x03：搜索所有的文件操作函数，分析其逻辑"><a href="#0x03：搜索所有的文件操作函数，分析其逻辑" class="headerlink" title="0x03：搜索所有的文件操作函数，分析其逻辑"></a>0x03：搜索所有的文件操作函数，分析其逻辑</h2><p>原因：文件操作函数属于敏感函数，往往业务逻辑上的漏洞可能导致任意文件操作</p>
<p>可能出现的场景：</p>
<h3 id="a-任意文件下载"><a href="#a-任意文件下载" class="headerlink" title="a) 任意文件下载"></a>a) 任意文件下载</h3><p><a href="http://wooyun.anquan.us/bug_detail.php?wybug_id=wooyun-2013-038800" target="_blank">WooYun: appcms 最新版 1.3.708 任意文件下载</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'url'</span>]) &amp;&amp; trim($_GET[<span class="string">'url'</span>]) != <span class="string">''</span> &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'type'</span>])) &#123;  </span><br><span class="line">    $img_url = base64_decode($_GET[<span class="string">'url'</span>]);  </span><br><span class="line">    $shffix = trim($_GET[<span class="string">'type'</span>]);  </span><br><span class="line">header(<span class="string">"Content-Type: image/&#123;$shffix&#125;"</span>);  </span><br><span class="line">readfile($img_url);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'image not find'</span>);  </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>PS：由于是业务逻辑上的问题，是没办法通过自动扫描发现的，而且针对<code>SQL</code>和<code>HTML</code>的过滤是起不到特大作用的</p>
<p>任意文件读取的最大作用是读<code>config.php</code>和各种系统的敏感文件（如何爆物理目录？请看<code>0x04</code>）</p>
<h3 id="b-任意文件写入"><a href="#b-任意文件写入" class="headerlink" title="b) 任意文件写入"></a>b) 任意文件写入</h3><p><a href="http://wooyun.anquan.us/bug_detail.php?wybug_id=wooyun-2013-046603" target="_blank">WooYun: CSCMS V3.5 最新版 后台命令执行GETSHELL（源码详析）</a></p>
<p>发帖时仍未公开，所以先不做分析，等公开后更新~</p>
<p>任意文件写入的最大应用就是写马了，最大障碍是绕过过滤的<code>HTML</code>字符比如:<code>&lt;&gt;</code>，解决方式是大量应用<code>base64</code></p>
<h3 id="c-任意文件删除"><a href="#c-任意文件删除" class="headerlink" title="c) 任意文件删除"></a>c) 任意文件删除</h3><p>很遗憾，还没撞见过，要是撞见一个该多好</p>
<p>任意文件删除的作用可以是删除<code>install.lock</code>，然后重装<code>CMS</code></p>
<h3 id="d-其他操作，求补充"><a href="#d-其他操作，求补充" class="headerlink" title="d) 其他操作，求补充"></a>d) 其他操作，求补充</h3><p>文件操作可以结合爆目录</p>
<h2 id="0x04：爆物理目录"><a href="#0x04：爆物理目录" class="headerlink" title="0x04：爆物理目录"></a>0x04：爆物理目录</h2><p>原因：上一小节我们可能能够任意操作文件，但没拿到网站的物理目录地址，的确可以用黑盒不停地试图读取<code>c:\boot.ini</code>和<code>/etc/passwd</code>之类的来试图判断，但是这么弄实在不可靠</p>
<p>怎么办：使用<code>php vulnerability hunter</code>自动扫描就好了，这个确实可以偷懒用工具扫描，因为这个爆目录危害实在太低了，必须配合其他漏洞才有危害，所以一般<code>CMS</code>都会有这种漏洞，我是说能扫描出来的漏洞</p>
<p><a href="http://wooyun.anquan.us/bug_detail.php?wybug_id=wooyun-2013-038800" target="_blank">WooYun: appcms 最新版 1.3.708 任意文件下载</a></p>
<p>如果你不知道物理路径，你可以试着用工具扫描一下，然后再读取</p>
<h2 id="0x05：搜索eval-preg-replace什么的，看看有没有命令执行"><a href="#0x05：搜索eval-preg-replace什么的，看看有没有命令执行" class="headerlink" title="0x05：搜索eval preg_replace什么的，看看有没有命令执行"></a>0x05：搜索eval preg_replace什么的，看看有没有命令执行</h2><p>原因：能直接执行<code>PHP</code>代码，也就是说可以写一句话木马了（<code>file_put_contents</code>），当然，要找可写目录</p>
<p>这地方我一直没能找到例子，没有亲自实践过，求各路高手带实例提供几个？</p>
<h2 id="0x06：可以开始通读代码了，从index开始，注意的是数据的传输和输出函数"><a href="#0x06：可以开始通读代码了，从index开始，注意的是数据的传输和输出函数" class="headerlink" title="0x06：可以开始通读代码了，从index开始，注意的是数据的传输和输出函数"></a>0x06：可以开始通读代码了，从index开始，注意的是数据的传输和输出函数</h2><p>原因：常见模式化的漏洞都不存在的话，就要分析整个系统了，因此需要完全而彻底地去做审计，这样比继续单独搜索变量然后跟踪更加省力一些</p>
<p>可能出现的场景：</p>
<h3 id="a-之前的过滤全白费了"><a href="#a-之前的过滤全白费了" class="headerlink" title="a) 之前的过滤全白费了"></a>a) 之前的过滤全白费了</h3><p><a href="http://wooyun.anquan.us/bug_detail.php?wybug_id=wooyun-2013-046585" target="_blank">WooYun: YXcms1.2.0版本 存储式XSS（实站演示+源码分析）</a></p>
<p>没公开，等公开再更新文章，这是一个存储式<code>xss</code></p>
<h3 id="b-二次注入"><a href="#b-二次注入" class="headerlink" title="b) 二次注入"></a>b) 二次注入</h3><p>由于二次开发中从数据库里取出的值没有过滤，导致注射，由于没有直接从用户输入中获得，所以之前步骤很难发现</p>
<p>哎呀，求各路高手提供个示例呀，我这个自己也没有碰到过丫</p>
<h3 id="c-平行权限、任意投票、越权访问-等等-等等-一大堆"><a href="#c-平行权限、任意投票、越权访问-等等-等等-一大堆" class="headerlink" title="c) 平行权限、任意投票、越权访问 等等 等等 一大堆"></a>c) 平行权限、任意投票、越权访问 等等 等等 一大堆</h3><h2 id="0x07-总结"><a href="#0x07-总结" class="headerlink" title="0x07 总结"></a>0x07 总结</h2><p>目前我就知道这么些，希望能对刚接触<code>PHP</code>代码审计漏洞挖掘的新手有点帮助，由于我也是刚开始学习<code>PHP</code>漏洞挖掘不久，希望大家能广泛提供学习的建议以及思路，也请批评指正文章中不妥之处，更希望高手们能带着示例来指导。</p>
<p><code>lxj616@乌云知识库</code></p>
</section>
    <!-- Tags START -->
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2019/07/27/PHP漏洞挖掘思路+实例 第二章/">
        <span class="nav-arrow">← </span>
        
          (untitled)
        
      </a>
    
    
      <a class="nav-right" href="/2019/07/27/代码审计的艺术系列 - 第八篇/">
        
          (untitled)
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- 打赏 START -->
    
      <div class="money-like">
        <div class="reward-btn">
          赏
          <span class="money-code">
            <span class="alipay-code">
              <div class="code-image"></div>
              <b>使用支付宝打赏</b>
            </span>
            <span class="wechat-code">
              <div class="code-image"></div>
              <b>使用微信打赏</b>
            </span>
          </span>
        </div>
        <p class="notice">若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏</p>
      </div>
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">扫描二维码，分享此文章</p>
      </div>
    
    <!-- 二维码 END -->
    
      <!-- No Comment -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#0x01-搜索所有的用户可控变量（GET-POST-COOKIE-referer）"><span class="toc-nav-text">0x01:  搜索所有的用户可控变量（GET/POST/COOKIE/referer）</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#a-id-GET-‘id’"><span class="toc-nav-text">a) id=$_GET[‘id’];</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#b-id-intval-GET-‘id’"><span class="toc-nav-text">b) id=intval($_GET[‘id’]);</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#c-tid-XX-Request-“tid”"><span class="toc-nav-text">c) $tid=XX_Request(“tid”);</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#c1-有没有忘记使用这个处理函数？"><span class="toc-nav-text">c1) 有没有忘记使用这个处理函数？</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#c2-函数本身是否安全？"><span class="toc-nav-text">c2) 函数本身是否安全？</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#c3-过滤函数能否满足业务逻辑的特殊需求？"><span class="toc-nav-text">c3) 过滤函数能否满足业务逻辑的特殊需求？</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#d-不要忘记我们能控制referer等变量"><span class="toc-nav-text">d) 不要忘记我们能控制referer等变量</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#e-还有其他的输入变量，请各路高手带着实例补充！"><span class="toc-nav-text">e) 还有其他的输入变量，请各路高手带着实例补充！</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#0x02：单独搜索-COOKIE，分析身份认证时的逻辑"><span class="toc-nav-text">0x02：单独搜索$_COOKIE，分析身份认证时的逻辑</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#a-没有cookie处理，直接全是session"><span class="toc-nav-text">a) 没有cookie处理，直接全是session</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#b-认证算法中强度太弱（用可控的COOKIE算来算去），降低了伪造身份的难度"><span class="toc-nav-text">b) 认证算法中强度太弱（用可控的COOKIE算来算去），降低了伪造身份的难度</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#c-直接能绕过"><span class="toc-nav-text">c) 直接能绕过</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#0x03：搜索所有的文件操作函数，分析其逻辑"><span class="toc-nav-text">0x03：搜索所有的文件操作函数，分析其逻辑</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#a-任意文件下载"><span class="toc-nav-text">a) 任意文件下载</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#b-任意文件写入"><span class="toc-nav-text">b) 任意文件写入</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#c-任意文件删除"><span class="toc-nav-text">c) 任意文件删除</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#d-其他操作，求补充"><span class="toc-nav-text">d) 其他操作，求补充</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#0x04：爆物理目录"><span class="toc-nav-text">0x04：爆物理目录</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#0x05：搜索eval-preg-replace什么的，看看有没有命令执行"><span class="toc-nav-text">0x05：搜索eval preg_replace什么的，看看有没有命令执行</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#0x06：可以开始通读代码了，从index开始，注意的是数据的传输和输出函数"><span class="toc-nav-text">0x06：可以开始通读代码了，从index开始，注意的是数据的传输和输出函数</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#a-之前的过滤全白费了"><span class="toc-nav-text">a) 之前的过滤全白费了</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#b-二次注入"><span class="toc-nav-text">b) 二次注入</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#c-平行权限、任意投票、越权访问-等等-等等-一大堆"><span class="toc-nav-text">c) 平行权限、任意投票、越权访问 等等 等等 一大堆</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#0x07-总结"><span class="toc-nav-text">0x07 总结</span></a></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'https://storysec.github.io/2019/07/27/PHP漏洞挖掘思路+实例 第一章/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>


  <script>
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });
  </script>






    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2019 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a href="https://github.com/yanm1ng">yanm1ng</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>
  </body>
</html>